<?xml version="1.0" encoding="UTF-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.2.9 -->

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC7540 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7540.xml">
<!ENTITY RFC8288 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8288.xml">
<!ENTITY RFC7240 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7240.xml">
<!ENTITY I-D.ietf-httpbis-header-structure SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-httpbis-header-structure.xml">
<!ENTITY W3C.CR-preload-20171026 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml4/reference.W3C.CR-preload-20171026.xml">
<!ENTITY RFC4287 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4287.xml">
]>


<rfc docName="draft-pot-prefer-push-00" category="std">

  <front>
    <title>HTTP-client suggested Push Preference</title>

    <author initials="." surname="Evert Pot">
      <organization></organization>
      <address>
        <email>me@evertpot.com</email>
        <uri>https://evertpot.com/</uri>
      </address>
    </author>

    <date year="2018" month="November" day="15"/>

    
    
    

    <abstract>


<t>TODO</t>



    </abstract>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>HTTP/2 <xref target="RFC7540"/> allows a server to push requests and responses to a HTTP
client, in anticipation that the client will need them in the near future.</t>

<t>This mechanism is completely controlled by the server, and it is up to
implementors of services to anticipate what resources a client might need
next. Some implementations of this feature attempt to intelligently guess
which resources a client might need based on past behavior.</t>

<t>This specification defines a new HTTP header that allows a client to inform a
server of resources they will require next based on a link relation type
<xref target="RFC8288"/>.</t>

</section>
<section anchor="rationale" title="Rationale">

<t>Many HTTP-based services provide some mechanism to embed the HTTP response
bodies of resources into other HTTP resource. A common example of this when
a resource is structured as a “collection of resources”. Examples of this
include:</t>

<t><list style="symbols">
  <t>The Atom Syndication Format <xref target="RFC4287"/> that encodes <spanx style="verb">ATOM:entry</spanx> XML
elements for each subordinate.</t>
  <t>The <xref target="HAL"></xref> format, which provides an <spanx style="verb">_embedded</spanx> element to embedding bodies
of resources in other resources.</t>
  <t>The <xref target="JSON-API"></xref> format, which provides a <spanx style="verb">included</spanx> property to embed
resources.</t>
</list></t>

<t>Embedding resource responses in other resources has two major peformance
advantages:</t>

<t><list style="numbers">
  <t>It reduces the number of roundtrips. A client can make a single HTTP request
and get many responses.</t>
  <t>Generating a set of resources can often be implemented on a server to
be less time consuming that generating each response individually.</t>
</list></t>

<t>These mechanism also pose an issue. HTTP clients and intermediates and caches
are not aware of these embedded resources, because there was never a real HTTP
request.</t>

<t>By leveraging HTTP/2 push instead of poorly standardized embedding mechanisms,
it’s possible for services to push subordinate resources as soon as possible,
generate HTTP responses as a “set” all while still taking advantage of existing
HTTP infrastructure.</t>

<t>In many REST apis, sub-ordiniate or embedded resources are identified by their
link relation. By using the link relation, it will be possible for a client
to indicate to a server which links they intent to follow, allowing a server
to only push the resources that the client knows it will need.</t>

</section>
<section anchor="the-header-format" title="The header format">

<t><spanx style="strong">Note</spanx>: the following subsections contain several proposals. Only one should
stay in this specification, but all suggestions are currently listed for
completeness.</t>

<t>Each subsection contains an example of a <spanx style="verb">Prefer-Push</spanx> header, but also stated
as a new parameter of the <spanx style="verb">Prefer</spanx> header <xref target="RFC7240"/>. In this case also only 1
should stay in this document before duplication.</t>

<section anchor="single-depth-pushes" title="Single-depth pushes">

<t>The simplest version of this only allows single depth push preferences. This
means that the <spanx style="verb">Prefer-Push</spanx> header can only be used for linked resources from
the context resource.</t>

<section anchor="example-using-prefer-push-header" title="Example using Prefer-Push header">

<t>This format should uses the “List” format from the Structured Headers format
<xref target="I-D.ietf-httpbis-header-structure"/>.</t>

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer-Push: item, author, "https://example.org/custom-rel"
]]></artwork></figure>

</section>
<section anchor="example-using-prefer-header" title="Example using Prefer header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer: push="item, author, \"https://example.org/custom-rel\""
]]></artwork></figure>

</section>
</section>
<section anchor="n-depth-pushes" title="N-depth pushes">

<t>Hypermedia clients often will need to follow a chain of links, it might
therefore be benefitial to allow clients to specify relations at multiple
depths.</t>

<t>The following example requests for the server to push the resources linked
via the “item” and “icon” relation. For each of the resources linked via
the “item” relationship, it also requests the “author” relationship and
custom link relationship to be pushed.</t>

<section anchor="example-using-prefer-push-header-1" title="Example using Prefer-Push header">

<t>Because the Structered Headers format does not have a way to define headers
of arbitrarly depth, a custom format is used. This format is intended to
resemble existing HTTP headers but there’s no direct equivalent.</t>

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer-Push: item(author, "https://example.org/custom-rel"), icon
]]></artwork></figure>

</section>
<section anchor="example-using-prefer-header-1" title="Example using Prefer header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer: push="item(author, \"https://example.org/custom-rel\"), icon"
]]></artwork></figure>

</section>
</section>
<section anchor="n-depth-pushes-with-s-expression-syntax" title="N-depth pushes with S-expression syntax">

<t>The following example expresses the same information, but instead of a custom
format it uses <xref target="S-expression"/>.</t>

<section anchor="example-using-prefer-push-header-2" title="Example using Prefer-Push header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer-Push: (item(author "https://example.org/custom-rel") icon)
]]></artwork></figure>

</section>
<section anchor="example-using-prefer-header-2" title="Example using Prefer header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer: push="(item(author \"https://example.org/custom-rel\") icon)"
]]></artwork></figure>

</section>
</section>
</section>
<section anchor="server-pushes" title="Server pushes">

<t>When a server receives the <spanx style="verb">Prefer(-Push)</spanx> header, it can choose to push the
related resources.</t>

<t>It’s possible for a resource to be references multiple times via different
link-relationships. The server must de-duplicate these responses.</t>

<t>A server is free to ignore push-requests.</t>

</section>
<section anchor="abnf-syntax" title="ABNF syntax">

<t>TODO when format is picked</t>

</section>
<section anchor="using-with-preload-relationship-types" title="Using with “preload” relationship types">

<t><xref target="W3C.CR-preload-20171026"/> defines a “preload” relationship type, that an
origin can use to inform a client to start fetching a resource, or a proxy
to initiate a HTTP/2 push.</t>

<t>Clients interacting with servers or proxies implementing “preload” could
discard <spanx style="verb">Prefer-Push: preload</spanx>, as it would be a no-op, but this is not
recommended as servers and proxies could still take this as a hint that
a Push is desired.</t>

<t>A distinct difference between <spanx style="verb">preload</spanx> and <spanx style="verb">Prefer-Push</spanx> is that <spanx style="verb">preload</spanx>
can be used by origin servers to inform clients and intermediates to fetch
and potentially push resources optimistically, but fundamentally <spanx style="verb">Prefer-Push</spanx>
is a completely client-driven mechanism.</t>

</section>
<section anchor="security-considerations" title="Security considerations">

<t>The Prefer-Push mechanism can potentially result in a large number of
resources being pushed. This can result in a Denial-of-Service attack.</t>

<t>A server must set reasonable restrictions around the amount of pushes it
sends. In the case of N-Depth pushes, servers SHOULD also set restrictions
around the depth it supports.</t>

</section>
<section anchor="iana-considerations" title="IANA considerations">

<t>TODO: Put registry updates where a decision is made on Prefer/Prefer-Push.</t>

</section>
<section anchor="acknowledgements" title="Acknowledgements">

</section>


  </middle>

  <back>

    <references title='Normative References'>

&RFC7540;
&RFC8288;
&RFC7240;
&I-D.ietf-httpbis-header-structure;
&W3C.CR-preload-20171026;


    </references>

    <references title='Informative References'>

&RFC4287;
<reference anchor="HAL" target="https://tools.ietf.org/html/draft-kelly-json-hal-00">
  <front>
    <title>JSON Hypertext Application Language</title>
    <author initials="M." surname="Kelly" fullname="Mike Kelly">
      <organization></organization>
    </author>
    <date year="2012" month="June" day="07"/>
  </front>
</reference>
<reference anchor="JSON-API" target="https://jsonapi.org/format/">
  <front>
    <title>JSON:API</title>
    <author >
      <organization></organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>
<reference anchor="S-expression" target="https://en.wikipedia.org/wiki/S-expression">
  <front>
    <title>S-expressions</title>
    <author >
      <organization></organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>


    </references>




  </back>

<!-- ##markdown-source:
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
aU0udbEK94Phcn+BoAnxH+UEuGrTGgAA

-->

</rfc>

