<?xml version="1.0" encoding="UTF-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.2.9 -->

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC7540 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7540.xml">
<!ENTITY RFC8288 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8288.xml">
<!ENTITY RFC7240 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7240.xml">
<!ENTITY I-D.ietf-httpbis-header-structure SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-httpbis-header-structure.xml">
<!ENTITY W3C.CR-preload-20171026 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml4/reference.W3C.CR-preload-20171026.xml">
<!ENTITY RFC4287 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4287.xml">
]>


<rfc docName="draft-pot-prefer-push-00" category="std">

  <front>
    <title>HTTP-client suggested Push Preference</title>

    <author initials="." surname="Evert Pot">
      <organization></organization>
      <address>
        <email>me@evertpot.com</email>
        <uri>https://evertpot.com/</uri>
      </address>
    </author>

    <date year="2018" month="November" day="15"/>

    
    
    

    <abstract>


<t>TODO</t>



    </abstract>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>HTTP/2 <xref target="RFC7540"/> allows a server to push request and response pairs to
HTTP clients. This can save round-trips between server and client and
reduces the total time required for a client to retrieve all requested
resources.</t>

<t>This mechanism is completely controlled by the server, and it is up to
implementors of services to anticipate what resources a client might need
next.</t>

<t>This specification defines a new HTTP header that allows a client to inform a
server of resources they will require next based on a link relation type
<xref target="RFC8288"/>.</t>

</section>
<section anchor="rationale" title="Rationale">

<t>Many HTTP-based services provide some mechanism to embed the HTTP response
bodies of resources into other HTTP resource. A common example of this is when
a resource is structured as a “collection of resources”. Examples of this
include:</t>

<t><list style="symbols">
  <t>The Atom Syndication Format <xref target="RFC4287"/> that encodes <spanx style="verb">ATOM:entry</spanx> XML
elements for each subordinate.</t>
  <t>The <xref target="HAL"></xref> format, which provides an <spanx style="verb">_embedded</spanx> element to embedding bodies
of resources in other resources.</t>
  <t>The <xref target="JSON-API"></xref> format, which provides a <spanx style="verb">included</spanx> property to embed
resources.</t>
</list></t>

<t>Embedding resource responses in other resources has two major peformance
advantages:</t>

<t><list style="numbers">
  <t>It reduces the number of roundtrips. A client can make a single HTTP request
and get many responses.</t>
  <t>Generating a set of resources can often be implemented on a server to
be less time consuming that generating each response individually.</t>
</list></t>

<t>These mechanism also pose an issue. HTTP clients and intermediates and caches
are not aware of these embedded resources, because there was never a real HTTP
request.</t>

<t>By leveraging HTTP/2 push instead of format-specific embedding mechanisms,
it’s possible for services to push subordinate resources as soon as possible,
generate HTTP responses as a “set” all while still taking advantage of existing
HTTP infrastructure. Another advantage of HTTP/2 push over embedding it that
it allows resources of mixed mediatypes to be pushed.</t>

<t>In many REST apis, sub-ordiniate or embedded resources are identified by their
link relation. By using the link relation, it will be possible for a client
to indicate to a server which links they intent to follow, allowing a server
to only push the resources that the client knows it will need.</t>

</section>
<section anchor="the-header-format" title="The header format">

<t><spanx style="strong">Note</spanx>: the following subsections contain several proposals. Only one should
stay in this specification, but all suggestions are currently listed for
completeness.</t>

<t>Each subsection contains an example of a <spanx style="verb">Prefer-Push</spanx> header, but also stated
as a new parameter of the <spanx style="verb">Prefer</spanx> header <xref target="RFC7240"/>. In this case also only 1
should stay in this document before duplication.</t>

<section anchor="single-depth-pushes" title="Single-depth pushes">

<t>The simplest version of this only allows single depth push preferences. This
means that the <spanx style="verb">Prefer-Push</spanx> header can only be used for linked resources from
the context resource.</t>

<section anchor="example-using-prefer-push-header" title="Example using Prefer-Push header">

<t>This format should uses the “List” format from the Structured Headers format
<xref target="I-D.ietf-httpbis-header-structure"/>.</t>

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer-Push: item, author, "https://example.org/custom-rel"
]]></artwork></figure>

</section>
<section anchor="example-using-prefer-header" title="Example using Prefer header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer: push="item, author, \"https://example.org/custom-rel\""
]]></artwork></figure>

</section>
</section>
<section anchor="n-depth-pushes" title="N-depth pushes">

<t>Hypermedia clients often will need to follow a chain of links, it might
therefore be benefitial to allow clients to specify relations at multiple
depths.</t>

<t>The following example requests for the server to push the resources linked
via the “item” and “icon” relation. For each of the resources linked via
the “item” relationship, it also requests the “author” relationship and
custom link relationship to be pushed.</t>

<section anchor="example-using-prefer-push-header-1" title="Example using Prefer-Push header">

<t>Because the Structered Headers format does not have a way to define headers
of arbitrarly depth, a custom format is used. This format is intended to
resemble existing HTTP headers but there’s no direct equivalent.</t>

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer-Push: item(author, "https://example.org/custom-rel"), icon
]]></artwork></figure>

</section>
<section anchor="example-using-prefer-header-1" title="Example using Prefer header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer: push="item(author, \"https://example.org/custom-rel\"), icon"
]]></artwork></figure>

</section>
</section>
<section anchor="n-depth-pushes-with-s-expression-syntax" title="N-depth pushes with S-expression syntax">

<t>The following example expresses the same information, but instead of a custom
format it uses <xref target="S-expression"/>.</t>

<section anchor="example-using-prefer-push-header-2" title="Example using Prefer-Push header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer-Push: (item(author "https://example.org/custom-rel") icon)
]]></artwork></figure>

</section>
<section anchor="example-using-prefer-header-2" title="Example using Prefer header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer: push="(item(author \"https://example.org/custom-rel\") icon)"
]]></artwork></figure>

</section>
</section>
</section>
<section anchor="server-pushes" title="Server pushes">

<t>When a server receives the <spanx style="verb">Prefer(-Push)</spanx> header, it can choose to push the
related resources.</t>

<t>It’s possible for a resource to be references multiple times via different
link-relationships. The server must de-duplicate these responses.</t>

<t>A server is free to ignore push-requests.</t>

</section>
<section anchor="abnf-syntax" title="ABNF syntax">

<t>TODO when format is picked</t>

</section>
<section anchor="using-with-preload-relationship-types" title="Using with “preload” relationship types">

<t><xref target="W3C.CR-preload-20171026"/> defines a “preload” relationship type. This
relationship type can be used by an origin to inform a client or intermediate
to start fetching a resource, or a proxy to initiate a HTTP/2 push.</t>

<t>Clients interacting with servers or proxies implementing “preload” could
discard <spanx style="verb">Prefer-Push: preload</spanx>, as it would be a no-op, but this is not
recommended as servers and proxies could still take this as a hint that
a Push is desired.</t>

<t>A distinct difference between <spanx style="verb">preload</spanx> and <spanx style="verb">Prefer-Push</spanx> is that <spanx style="verb">preload</spanx>
can be used by origin servers to inform clients and intermediates to fetch
and potentially push resources optimistically, but fundamentally <spanx style="verb">Prefer-Push</spanx>
is a completely client-driven mechanism.</t>

</section>
<section anchor="security-considerations" title="Security considerations">

<t>The Prefer-Push mechanism can potentially result in a large number of
resources being pushed. This can result in a Denial-of-Service attack.</t>

<t>A server must set reasonable restrictions around the amount of pushes it
sends. In the case of N-Depth pushes, servers SHOULD also set restrictions
around the depth it supports.</t>

</section>
<section anchor="iana-considerations" title="IANA considerations">

<t>TODO: Put registry updates where a decision is made on Prefer/Prefer-Push.</t>

</section>
<section anchor="acknowledgements" title="Acknowledgements">

</section>


  </middle>

  <back>

    <references title='Normative References'>

&RFC7540;
&RFC8288;
&RFC7240;
&I-D.ietf-httpbis-header-structure;
&W3C.CR-preload-20171026;


    </references>

    <references title='Informative References'>

&RFC4287;
<reference anchor="HAL" target="https://tools.ietf.org/html/draft-kelly-json-hal-00">
  <front>
    <title>JSON Hypertext Application Language</title>
    <author initials="M." surname="Kelly" fullname="Mike Kelly">
      <organization></organization>
    </author>
    <date year="2012" month="June" day="07"/>
  </front>
</reference>
<reference anchor="JSON-API" target="https://jsonapi.org/format/">
  <front>
    <title>JSON:API</title>
    <author >
      <organization></organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>
<reference anchor="S-expression" target="https://en.wikipedia.org/wiki/S-expression">
  <front>
    <title>S-expressions</title>
    <author >
      <organization></organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>


    </references>




  </back>

<!-- ##markdown-source:
H4sIAJZr8FsAA7VZa2/cuBX9zl9BTD5sNhiNH93dBAMUqPPauE3iIPZiC3SL
miNxZriWRJWkbA8C97f33EtS0jhJ4wKtEQOKRN73PffhoihEpYJeyuPDo2fF
0VFx9KMIJtR4M3tzcfGhKGuj2yB9v9loH3QlP/R+Kz84vdZOt6WeicqWrWpw
oXJqHYrO4pc/Fx2OFoeHogSHjXW7pfShEqoPW+uWQsoCv1Ka1i/lq2vtgvxg
A7/SjTL1Ujb6T5reg+SitA1/6p1Zym0InV8eHEy/HojWukYFc62J9sfXL57+
+MNhenx2/OxZfnsc354WLxdGh3VBxFbGF1utKgjtg+vL0Dum8usfXixefCR9
aquqAkZ6enR4/NNSCNOu77H74fjZU3p8c/J2yaIWsOFW1TP+TzLqn8/P3ss3
uw5y69sgT7quNjCPsa18q9pNrzaaj49Gop9o39k7c6XlX3Rd7yLNwXPHxeFP
xeHTyEi5jQ6jjYK1tWdNF9ZtDrahqQ+ip66IUvG7t20BMclRkuUrTj6cDhrw
Z9WZ+0osceiL/OgCzjOzaKIDnDsv9C2s6D00Ha3j8XLPPLPpOT/7IgPdLm7M
lel0ZRRzof8dTC8KURSFVCu4UpVBiIuzl2fxXWOqqtZCPJKnbXC2gqf5PIX6
wbH89CmFzd2dVHVtb7xU0muHMJPBSopn6fQ/e2SCVG2FZ99BTi07ZZzHESYk
Y874hbzYGi9L1UqvrrV0tm+rIjjTebnS4UbrNhMnYinT8CichmQaBLcaRIOq
YZ9GM2uDbxJ2hWDpAgRzGlSRDCR0FlATGW97B0IL2IBEaXS5Va3xjSS5bNPV
Ouh6h0eyRl2D9GrHXKNccxbMBDred6SfoTsN2Froa9d8zrCoFmeDKU2HoJQ3
WxXkwH6UtTGbbZCthnAt4j/L5TtdmnVOhEqvTcu3Wn0j2aIxNyEZyA6OGfWP
ySiVSOaEYCNzqLOTNyZZBvaTxFqulIe6YKdkbdorfKwj+4DsFBwJhBp3dwsK
l4/8TVHsvFPtjqUqIonBBJ2z16aC7Sx8NZoa8ulmhYNkV9Ymh41Y2cpovy+u
gW2lxVk3HOYvC3lCLmsgob5V5Aa6F8h8+Hez1a1Qw2F6NQBZJRWZa1aShzng
9zjOFvJVJOgzRaBbWfcVkE08QRBreRJsI893bZV99JozOyYMAR8Shp2DkmAr
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

-->

</rfc>

