<?xml version="1.0" encoding="UTF-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.2.9 -->

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC7540 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7540.xml">
<!ENTITY RFC8288 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8288.xml">
<!ENTITY RFC7240 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7240.xml">
<!ENTITY I-D.ietf-httpbis-header-structure SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-httpbis-header-structure.xml">
<!ENTITY W3C.REC-selectors-3-20181106 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml4/reference.W3C.REC-selectors-3-20181106.xml">
<!ENTITY RFC4287 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4287.xml">
]>


<rfc docName="draft-pot-prefer-push-00" category="std">

  <front>
    <title>HTTP-client suggested Push Preference</title>

    <author initials="." surname="Evert Pot">
      <organization></organization>
      <address>
        <email>me@evertpot.com</email>
        <uri>https://evertpot.com/</uri>
      </address>
    </author>

    <date year="2018" month="November" day="15"/>

    
    
    

    <abstract>


<t>TODO</t>



    </abstract>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>HTTP/2 <xref target="RFC7540"/> allows a server to push requests and responses to a HTTP
client, in anticipation that the client will need them in the near future.</t>

<t>This mechanism is completely controlled by the server, and it is up to
implementors of services to anticipate what resources a client might need
next. Some implementations of this feature attempt to intelligently guess
which resources a client might need based on past behavior.</t>

<t>This specification defines a new HTTP header that allows a client to inform a
server of resources they will require next based on a link relation type
<xref target="RFC8288"/>.</t>

</section>
<section anchor="rationale" title="Rationale">

<t>Many HTTP-based services provide some mechanism to embed the HTTP response
bodies of resources into other HTTP resource. A common example of this when
a resource is structured as a “collection of resources”. Examples of this
include:</t>

<t><list style="symbols">
  <t>The Atom Syndication Format <xref target="RFC4287"/> that encodes <spanx style="verb">ATOM:entry</spanx> XML
elements for each subordinate.</t>
  <t>The <xref target="HAL"></xref> format, which provides an <spanx style="verb">_embedded</spanx> element to embedding bodies
of resources in other resources.</t>
  <t>The <xref target="JSON-API"></xref> format, which provides a <spanx style="verb">included</spanx> property to embed
resources.</t>
</list></t>

<t>Embedding resource responses in other resources has two major peformance
advantages:</t>

<t><list style="numbers">
  <t>It reduces the number of roundtrips. A client can make a single HTTP request
and get many responses.</t>
  <t>Generating a set of resources can often be implemented on a server to
be less time consuming that generating each response individually.</t>
</list></t>

<t>These mechanism also pose an issue. HTTP clients and intermediates and caches
are not aware of these embedded resources, because there was never a real HTTP
request.</t>

<t>By leveraging HTTP/2 push instead of poorly standardized embedding mechanisms,
it’s possible for services to push subordinate resources as soon as possible,
generate HTTP responses as a “set” all while still taking advantage of existing
HTTP infrastructure.</t>

<t>In many REST apis, sub-ordiniate or embedded resources are identified by their
link relation. By using the link relation, it will be possible for a client
to indicate to a server which links they intent to follow, allowing a server
to only push the resources that the client knows it will need.</t>

</section>
<section anchor="the-header-format" title="The header format">

<t><spanx style="strong">Note</spanx>: the following subsections contain several proposals. Only one should
stay in this specification, but all suggestions are currently listed for
completeness.</t>

<t>Each subsection contains an example of a <spanx style="verb">Prefer-Push</spanx> header, but also stated
as a new parameter of the <spanx style="verb">Prefer</spanx> header <xref target="RFC7240"/>. In this case also only 1
should stay in this document before duplication.</t>

<section anchor="single-depth-pushes" title="Single-depth pushes">

<t>The simplest version of this only allows single depth push preferences. This
means that the <spanx style="verb">Prefer-Push</spanx> header can only be used for linked resources from
the context resource.</t>

<section anchor="example-using-prefer-push-header" title="Example using Prefer-Push header">

<t>This format should uses the “List” format from the Structured Headers format
<xref target="I-D.ietf-httpbis-header-structure"/>.</t>

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer-Push: item, author, "https://example.org/custom-rel"
]]></artwork></figure>

</section>
<section anchor="example-using-prefer-header" title="Example using Prefer header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer: push="item, author, \"https://example.org/custom-rel\"" 
]]></artwork></figure>

</section>
</section>
<section anchor="n-depth-pushes" title="N-depth pushes">

<t>Hypermedia clients often will need to follow a chain of links, it might
therefore be benefitial to allow clients to specify relations at multiple
depths.</t>

<t>The following example requests for the server to push the resources linked
via the “item” and “icon” relation. For each of the resources linked via
the “item” relationship, it also requests the “author” relationship and 
custom link relationship to be pushed.</t>

<section anchor="example-using-prefer-push-header-1" title="Example using Prefer-Push header">

<t>Because the Structered Headers format does not have a way to define headers
of arbitrarly depth, a custom format is used. This format is intended to
resemble existing HTTP headers but there’s no direct equivalent.</t>

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer-Push: item(author, "https://example.org/custom-rel"), icon
]]></artwork></figure>

</section>
<section anchor="example-using-prefer-header-1" title="Example using Prefer header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer: push="item(author, \"https://example.org/custom-rel\"), icon" 
]]></artwork></figure>

</section>
</section>
<section anchor="n-depth-pushes-with-s-expression-syntax" title="N-depth pushes with S-expression syntax">

<t>The following example expresses the same information, but instead of a custom
format it uses <xref target="S-expression"/>.</t>

<section anchor="example-using-prefer-push-header-2" title="Example using Prefer-Push header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer-Push: (item(author "https://example.org/custom-rel") icon)
]]></artwork></figure>

</section>
<section anchor="example-using-prefer-header-2" title="Example using Prefer header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer: push="(item(author \"https://example.org/custom-rel\") icon)" 
]]></artwork></figure>

</section>
</section>
<section anchor="n-depth-pushes-with-css-syntax" title="N-depth pushes with CSS syntax">

<t>A different suggestion was made using a combination of a subset of CSS3
selector syntax <xref target="W3C.REC-selectors-3-20181106"/> combined with the CSS
syntax of specifing urls.</t>

<section anchor="example-using-prefer-push-header-3" title="Example using Prefer-Push header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer-Push: item, item > author, item >
  url("https://example.org/custom-rel"), icon
]]></artwork></figure>

</section>
<section anchor="example-using-prefer-header-3" title="Example using Prefer header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer: push="item, item > author, item >
  url(\"https://example.org/custom-rel\"), icon" 
]]></artwork></figure>

</section>
</section>
<section anchor="n-depth-pushes-with-sparql-property-paths" title="N-depth pushes with SparQL property paths">

<t>The following format is inspired by SparQL property paths.</t>

<section anchor="example-using-prefer-push-header-4" title="Example using Prefer-Push header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer-Push: item / ( author, <https://example.org/custom-rel> ),
  icon
]]></artwork></figure>

</section>
<section anchor="example-using-prefer-header-4" title="Example using Prefer header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer: push="item / ( author, <https://example.org/custom-rel> ),
  icon"
]]></artwork></figure>

</section>
</section>
</section>
<section anchor="security-considerations" title="Security considerations">

<t>TODO</t>

<t>Note DDOS problems with arbitrary pushes. Servers MUST restrict pushes and/or
depth.</t>

</section>
<section anchor="acknowledgements" title="Acknowledgements">

</section>


  </middle>

  <back>

    <references title='Normative References'>

&RFC7540;
&RFC8288;
&RFC7240;
&I-D.ietf-httpbis-header-structure;
&W3C.REC-selectors-3-20181106;


    </references>

    <references title='Informative References'>

&RFC4287;
<reference anchor="HAL" target="https://tools.ietf.org/html/draft-kelly-json-hal-00">
  <front>
    <title>JSON Hypertext Application Language</title>
    <author initials="M." surname="Kelly" fullname="Mike Kelly">
      <organization></organization>
    </author>
    <date year="2012" month="June" day="07"/>
  </front>
</reference>
<reference anchor="JSON-API" target="https://jsonapi.org/format/">
  <front>
    <title>JSON:API</title>
    <author >
      <organization></organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>
<reference anchor="S-expression" target="https://en.wikipedia.org/wiki/S-expression">
  <front>
    <title>S-expressions</title>
    <author >
      <organization></organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>


    </references>




  </back>

<!-- ##markdown-source:
H4sIAILb7VsAA8VYbW/byBH+vr9ioHy4JBDll9xdAqE91Jc4l7RJnEYuWqBX
1CtyJe2Z5LLcpR01SH97n5ldUpTz5isuqGEb0u5yZnaemWdmmGWZKnQwczo+
PHqUHR1lR9+pYEOJlcmz8/PXWV5aUwfy3XptfDAFve78hl63ZmVaU+dmogqX
17rCA0WrVyFrHP5kO2twNDs8VDk0rF27nZMPhdJd2Lh2rogy/BHZ2s/p9Mq0
gV67IEum0racU2X+YHgdIme5q2Sra+2cNiE0fn5wMN49ULVrKx3slWHZb54+
fvjdt4dzip8fHT961C8fYxkfn2dPZtaEVcbSltZnG6MLWO1D2+Wha0XMXx88
nr05fZx5U5o8uNZnDzJ21dHR4fdzpWy9uqH02+NHD/njs5MXczE4gyc3upzI
l+TaPy7OXtGzbQPrzdtAJ01TWjjJuppe6Hrd6bWR4ztX8U/08uSlvTT0J1OW
2yhzwO84O/w+O3wYFel2bcLOU8G50st1Z65dH2xCVR5EvC5ZUvaLd3UGMxku
Evuyk9fPhxvItm7szUvMceij+vgBnBdl0UUHOLfIzFvEhve46c47Hot77pmM
z/nJRxWYenZtL21jCqtFC387GD+oVJZlpJfAU+dBqfOzJ2dxrbJFURql7tDz
OrSuANxyngP+4JjevUvB8/496bJ01540edMi2Cg44qim1vyrQz5gpy7wxTcw
1Hje1sRiVMybKaIbR4LNbRPxDRsd8M9QSqxrW5ZUGyQWFis+zpu10S2tOo7C
GSzfWI9kyDe6th5nPCHem9IEU27xke9QlpCw3MrD0dSpmGYDH+8aWKYsP1NB
KcKY3ErO2TxZ3dto6JotxJVc1/Km7i2t7HoTxFRVI2pntHCVoUGoXE/kBjZ3
ZTRbTzoEUzWBddgaBpd2jcOwew3/eXW9sfnm89poqT3+w3eN9oGWZqOvrGtn
lBzjG5PbVZ8/hVnZWgTV5lqgoJjX0fMDnkmNmMUBSloliHGDnT3w5zZixIjb
lqFBxg4maSptfYnNMsGLpFYSQMw479/POMreyJ7mkHup661YlUURAwZN665s
AfDYqTusYZ+pljE64m36YFNLV1jj982Fix05nG2Hw7IzoxOOmQoWmreaIRuA
ut6YWunhJIfLwIAFafbVJOf4kiTZUzeZ0WmUNuAORszLrgAbqvt0DptPgqto
sa2LHqCnwgYxyZgskWSCDIqJKyDo4uT87OUc2LTbC/rbyxfIfhMjDEHlWjIa
AeO7pWsLWyNeZ0nR38Fe/6DINVOKcZWcyllKF/8URxamuOgFDt6FpDVFf0Ld
DY8mfw5Lg8KeFD+tlS6SO6ATq8z320EpNO1kIphPB0sGLHbE8qEZtAE24dpR
pX+BWxojRqAiK11cIZ1RQzxQOJrRc05nkFwMZ6o7KIph7rq6CK1tvMRHzIgc
vqo0Sgw4D8aUQ9gJ4TEXM6+Ai3EKsTyYOFPHM/rJ1KYFzrgEU2bY9yWLdqtg
aiTxjjj6RBoYlnXgAKIKBlukAyjOdxULlUhZ75RIMPQmwEmFhec7JPlWaNP4
cS7p0oO9HdZgh/W+Q1rI3eLNI5czSbUVV5Vg4koOHYgLzbnvwCDX/EnCncX3
QbW75hTG57rDHgMGPgVONXcqxFmmy1gfkj9h5o9bXBXbes03SjVIigw6owDu
YmWNcy1I0wdYpBH5/4bGXegOd/RTZcM3nm/p7RLYccaMeV7kjrJnTL1IfMdI
7B6fquTrG9zjEy8A4QlTKgc+lPnARBn0peDfRyGbb95az4BJiWXGbfVAMnDB
8zoG05vTxTkho+BD2JiJkQwEcd5/4GhiIJBoKF0rO5Q/26o9Sp4RHNz5GD1m
n66nXB+F3RFvez7rC4SSAiHkZWJ1T2EaU52lpSLBgRMpZeW4yExjrelTgR9i
Ya4GjIICWzMuNPt9wWXNdcqOGgQpJUw8qZ5F0gHP3n/lgrl/fy6PR+WsFR70
kbS9NAkaHOIl0EohI+eREDM6Y4NcDfQ2risLhRDbxjbkZm1FYHdSQftpQEQz
CHnXtrGql1aGBNim+h4F1RjkoE4TbyebepOEm0c1CZwZh4uMB42LdNleNRIY
9kGD0n2Jb3SLvjhERmMPpOf7R1M7d8ztHLgwXSzXTAMsTwA5UvH2tHd7TDad
1Iklk6uhohv6dAbjDi2EILPCNGEjoIInmHbAnFIVA8HdPpVNESnaUhOS6HX3
NDXDWAVguLlRldH1KDg+5ptIqywXQdz56H2JzL1kWbWYoCTA4HjuYYbegK9y
p6/kKVVGepKa1G3FqEvBwupiUZm8APCTfpd1yfJi10k8Eym9APRIX5y/pHv6
D37UT6fndKBbtKjcaghFHs2O1MjIOVLFVNM0MU0xcvVzQryWjAh559GNZMj+
SZT7yYsPd/6y+rlA9/vJvv6fv2DAz5MJDTbQqxshJKOhFKGhNsW6OZoWep5h
qtpwbiPEhI6E1KR9VlKAJHSX/FujNw4W6c9EJs/20rEQU307cCPyC2K6MlhY
r8Q+H4vqiGP6xB3GIQ693QwyVJx9rouxqa5wPYkddt1Eau3EIjonI+5+2nd8
KblvCiEIUSMhg/Ub24gjJMcH8+RkxGj/rGhXEZ/9GiG7uAdXCIanuHW+/Lhr
A1IimA8TASSDy3BjgbGGm65rLS1inGOSLK+YGdulxSjLbYCgMWXko8FJFE96
yP9IHaNFKU2FBA36Do9KCrv7kjyekbzQrETNN2wUFZh4cvTmGH2uML/U4ddm
5N3bJuQ9oAXsv05e3r19WiY7Pp2dyEF8Hr9oIL9FKXv7qdxIBxNRes1Dc//a
qC+qo06vB1X1+IXIsu/ejXVyLbttHN4asLsjX30ZMPHTvd8esD0rbgFYtONL
gD1eLAacThDXKym0YdTKSKNewdp0Ac0T85K75FTAdWxfZKiBuAeqfymYBAOi
z70uxKAbBSIRxSQOB8hR6Wl+IxPbLSjv2tLfmmh+ZY3k//TDUKriV8WvVsu7
/9c0/bxpv13uomX884vdQN5olLab2TtmT9/YNs4XH3306+BEB3R3cMTvPn/1
H+jeFF76esj8j8YMbRYtDGYEG+R1pcfM1sba2r+V5QmGnjw5W7BrUZ2qBFVf
87YJwBkEcWPh6eVfMCqCDENrUaASvCjiB5g8BHIZl05ynqNKU6zjG6T4/nep
80ul/gt2zp1V/BgAAA==

-->

</rfc>

