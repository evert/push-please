<?xml version="1.0" encoding="UTF-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.2.9 -->

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC7540 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7540.xml">
<!ENTITY RFC8288 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8288.xml">
<!ENTITY RFC7240 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7240.xml">
<!ENTITY I-D.ietf-httpbis-header-structure SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-httpbis-header-structure.xml">
<!ENTITY W3C.REC-selectors-3-20181106 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml4/reference.W3C.REC-selectors-3-20181106.xml">
<!ENTITY RFC4287 SYSTEM "https://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.4287.xml">
]>


<rfc docName="draft-pot-prefer-push-00" category="std">

  <front>
    <title>HTTP-client suggested Push Preference</title>

    <author initials="." surname="Evert Pot">
      <organization></organization>
      <address>
        <email>me@evertpot.com</email>
        <uri>https://evertpot.com/</uri>
      </address>
    </author>

    <date year="2018" month="November" day="15"/>

    
    
    

    <abstract>


<t>TODO</t>



    </abstract>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>HTTP/2 <xref target="RFC7540"/> allows a server to push requests and responses to a HTTP
client, in anticipation that the client will need them in the near future.</t>

<t>This mechanism is completely controlled by the server, and it is up to
implementors of services to anticipate what resources a client might need
next. Some implementations of this feature attempt to intelligently guess
which resources a client might need based on past behavior.</t>

<t>This specification defines a new HTTP header that allows a client to inform a
server of resources they will require next based on a link relation type
<xref target="RFC8288"/>.</t>

</section>
<section anchor="rationale" title="Rationale">

<t>Many HTTP-based services provide some mechanism to embed the HTTP response
bodies of resources into other HTTP resource. A common example of this when
a resource is structured as a “collection of resources”. Examples of this
include:</t>

<t><list style="symbols">
  <t>The Atom Syndication Format <xref target="RFC4287"/> that encodes <spanx style="verb">ATOM:entry</spanx> XML
elements for each subordinate.</t>
  <t>The <xref target="HAL"></xref> format, which provides an <spanx style="verb">_embedded</spanx> element to embedding bodies
of resources in other resources.</t>
  <t>The <xref target="JSON-API"></xref> format, which provides a <spanx style="verb">included</spanx> property to embed
resources.</t>
</list></t>

<t>Embedding resource responses in other resources has two major peformance
advantages:</t>

<t><list style="numbers">
  <t>It reduces the number of roundtrips. A client can make a single HTTP request
and get many responses.</t>
  <t>Generating a set of resources can often be implemented on a server to
be less time consuming that generating each response individually.</t>
</list></t>

<t>These mechanism also pose an issue. HTTP clients and intermediates and caches
are not aware of these embedded resources, because there was never a real HTTP
request.</t>

<t>By leveraging HTTP/2 push instead of poorly standardized embedding mechanisms,
it’s possible for services to push subordinate resources as soon as possible,
generate HTTP responses as a “set” all while still taking advantage of existing
HTTP infrastructure.</t>

<t>In many REST apis, sub-ordiniate or embedded resources are identified by their
link relation. By using the link relation, it will be possible for a client
to indicate to a server which links they intent to follow, allowing a server
to only push the resources that the client knows it will need.</t>

</section>
<section anchor="the-header-format" title="The header format">

<t><spanx style="strong">Note</spanx>: the following subsections contain several proposals. Only one should
stay in this specification, but all suggestions are currently listed for
completeness.</t>

<t>Each subsection contains an example of a <spanx style="verb">Prefer-Push</spanx> header, but also stated
as a new parameter of the <spanx style="verb">Prefer</spanx> header <xref target="RFC7240"/>. In this case also only 1
should stay in this document before duplication.</t>

<section anchor="single-depth-pushes" title="Single-depth pushes">

<t>The simplest version of this only allows single depth push preferences. This
means that the <spanx style="verb">Prefer-Push</spanx> header can only be used for linked resources from
the context resource.</t>

<section anchor="example-using-prefer-push-header" title="Example using Prefer-Push header">

<t>This format should uses the “List” format from the Structured Headers format
<xref target="I-D.ietf-httpbis-header-structure"/>.</t>

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer-Push: item, author, "https://example.org/custom-rel"
]]></artwork></figure>

</section>
<section anchor="example-using-prefer-header" title="Example using Prefer header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer: push="item, author, \"https://example.org/custom-rel\""
]]></artwork></figure>

</section>
</section>
<section anchor="n-depth-pushes" title="N-depth pushes">

<t>Hypermedia clients often will need to follow a chain of links, it might
therefore be benefitial to allow clients to specify relations at multiple
depths.</t>

<t>The following example requests for the server to push the resources linked
via the “item” and “icon” relation. For each of the resources linked via
the “item” relationship, it also requests the “author” relationship and
custom link relationship to be pushed.</t>

<section anchor="example-using-prefer-push-header-1" title="Example using Prefer-Push header">

<t>Because the Structered Headers format does not have a way to define headers
of arbitrarly depth, a custom format is used. This format is intended to
resemble existing HTTP headers but there’s no direct equivalent.</t>

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer-Push: item(author, "https://example.org/custom-rel"), icon
]]></artwork></figure>

</section>
<section anchor="example-using-prefer-header-1" title="Example using Prefer header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer: push="item(author, \"https://example.org/custom-rel\"), icon"
]]></artwork></figure>

</section>
</section>
<section anchor="n-depth-pushes-with-s-expression-syntax" title="N-depth pushes with S-expression syntax">

<t>The following example expresses the same information, but instead of a custom
format it uses <xref target="S-expression"/>.</t>

<section anchor="example-using-prefer-push-header-2" title="Example using Prefer-Push header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer-Push: (item(author "https://example.org/custom-rel") icon)
]]></artwork></figure>

</section>
<section anchor="example-using-prefer-header-2" title="Example using Prefer header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer: push="(item(author \"https://example.org/custom-rel\") icon)"
]]></artwork></figure>

</section>
</section>
<section anchor="n-depth-pushes-with-css-syntax" title="N-depth pushes with CSS syntax">

<t>A different suggestion was made using a combination of a subset of CSS3
selector syntax <xref target="W3C.REC-selectors-3-20181106"/> combined with the CSS
syntax of specifing urls.</t>

<section anchor="example-using-prefer-push-header-3" title="Example using Prefer-Push header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer-Push: item, item > author, item >
  url("https://example.org/custom-rel"), icon
]]></artwork></figure>

</section>
<section anchor="example-using-prefer-header-3" title="Example using Prefer header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer: push="item, item > author, item >
  url(\"https://example.org/custom-rel\"), icon"
]]></artwork></figure>

</section>
</section>
<section anchor="n-depth-pushes-with-sparql-property-paths" title="N-depth pushes with SparQL property paths">

<t>The following format is inspired by SparQL property paths.</t>

<section anchor="example-using-prefer-push-header-4" title="Example using Prefer-Push header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer-Push: item / ( author, <https://example.org/custom-rel> ),
  icon
]]></artwork></figure>

</section>
<section anchor="example-using-prefer-header-4" title="Example using Prefer header">

<figure><artwork><![CDATA[
GET /articles HTTP/1.1
Prefer: push="item / ( author, <https://example.org/custom-rel> ),
  icon"
]]></artwork></figure>

</section>
</section>
</section>
<section anchor="server-pushes" title="Server pushes">

<t>When a server receives the <spanx style="verb">Prefer(-Push)</spanx> header, it can choose to push the
related resources.</t>

<t>It’s possible for a resource to be references multiple times via different
link-relationships. The server must de-duplicate these responses.</t>

<t>A server is free to ignore push-requests.</t>

<section anchor="abnf-syntax" title="ABNF syntax">

<t>TODO when format is picked</t>

</section>
</section>
<section anchor="security-considerations" title="Security considerations">

<t>The Prefer-Push mechanism can potentially result in a large number of
resources being pushed. This can result in a Denial-of-Service attack.</t>

<t>A server must set reasonable restrictions around the amount of pushes it
sends. In the case of N-Depth pushes, servers SHOULD also set restrictions
around the depth it supports.</t>

</section>
<section anchor="iana-considerations" title="IANA considerations">

<t>TODO: Put registry updates where a decision is made on Prefer/Prefer-Push.</t>

</section>
<section anchor="acknowledgements" title="Acknowledgements">

</section>


  </middle>

  <back>

    <references title='Normative References'>

&RFC7540;
&RFC8288;
&RFC7240;
&I-D.ietf-httpbis-header-structure;
&W3C.REC-selectors-3-20181106;


    </references>

    <references title='Informative References'>

&RFC4287;
<reference anchor="HAL" target="https://tools.ietf.org/html/draft-kelly-json-hal-00">
  <front>
    <title>JSON Hypertext Application Language</title>
    <author initials="M." surname="Kelly" fullname="Mike Kelly">
      <organization></organization>
    </author>
    <date year="2012" month="June" day="07"/>
  </front>
</reference>
<reference anchor="JSON-API" target="https://jsonapi.org/format/">
  <front>
    <title>JSON:API</title>
    <author >
      <organization></organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>
<reference anchor="S-expression" target="https://en.wikipedia.org/wiki/S-expression">
  <front>
    <title>S-expressions</title>
    <author >
      <organization></organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>


    </references>




  </back>

<!-- ##markdown-source:
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
PHh35i+rn3Hofj/a1f/rFwz4ddSbIM/vIYjnQq5BXWkKZXMwKrQ0Q0y1odQG
wpiNmNO4dxZcfxi5S/pXojP2BtlPPMbvttLxIGT6tqNGpBfENLk3MF6wfS7U
1AHFtHnbzUKEvH4A6QrOLtUFaIpbHI+hQ54bcakdGYBzNKDuV22/F3P7vhAJ
IWIgpLN+Yyp2BKd4Zx7vDCHa3UvaRYjOboXgRRyD6gNFJ3twtrzom4CYBvrD
NADF4CzUVmCkoZbrTnF/GIaYKMsJ4sV6aTDGUhPAwRhT4IPBURRNecj+QByD
h1yYMsYMug6HOgq724I8HJAckyyD5jsySmYYd1I05ph7bjG8lP6/zce9h6bj
YwQLof82Wbn38KSMdnwyN5GB+Dy8Y5Buizr29lOZETdGlnSK5uX2xqitqIM2
r42paMPnA8W+ezfUGabKB6HwweHaG3jqy+FiLz3++uHaseIB4Qp2fCFcLxeL
LkpzgHrFNdYPuhju0QsYG+1XNCsvqUGOtVuFzoXnGYh7KtrbwCgYAfrcPSFG
3CAQWcgmERggR8S36SomdFpQ3tS5+/rxDeWJfsufuioVvgq6Us33/q85+nnT
vlrioln881k/iVcKVe1+6g6Z01WmDpPFR1/9NmGSU7nX+eF3nz/5T/LxGE76
doH5H41pA4GRZRF6gba5+WWjB9M+Cow2t5EeY3e7x7543Pf+JtxKpBtLw/ug
qRBcpodtLg2THwzAg8utUMr7NrtrcfimwVE/0TMED5LJsBXgtrxrbwqcHNU4
aecCHe8EBnciIJy4mWpyrdkCsy6pKeO/jbS9SRgo5i/OX/UV5eLogm/nBpCs
TEq9U/Arxi7j+f7XYQyug5UBzkMQ9jcg5MXK0pxq6I6EDMXx+YZa5nS93l8O
ib7VWmpCUWx/QndBgoYvH2nM6XliV8kiXDbQra9Kb4YOYG8Rh9Za0d8Gltw4
ots3aTtJ0n0UI0EV+MhsG9PXeFBumbk4wekwwGH9PDkapPk4KnNycXLxl7Oj
ODKy0l6TGGgKJGGoGlSVrUMg5On8fP6hXxGPmbxsSNga7VO9lU2V8T3RHd/0
ADogce4KTKwn+BhCMR1EhFXMUxrxc52tw91m+MPEEk4T4j9ikAVUlBsAAA==

-->

</rfc>

